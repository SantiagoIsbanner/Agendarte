<div class="panel-container">
  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <div class="hero-icon">ü©∫</div>
      <h1>Mis Citas M√©dicas</h1>
      <p>Visualiza y gestiona tus citas programadas</p>
    </div>
    <div class="hero-stats">
      <div class="stat-item">
        <span class="stat-number">{{ getUpcomingAppointments() }}</span>
        <span class="stat-label">Citas Pr√≥ximas</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{ isAuthenticated() ? '‚úì' : '‚úó' }}</span>
        <span class="stat-label">Google Sync</span>
      </div>
    </div>
  </div>

  <!-- Action Bar -->
  <div class="action-bar">
    <div class="action-group">
      <button class="btn-modern primary" (click)="showNewAppointmentModal()">
        <span class="btn-icon">‚ûï</span>
        <span>Nueva Cita</span>
      </button>
      <button class="btn-modern secondary" (click)="loadCalendar()" [disabled]="!isAuthenticated()">
        <span class="btn-icon">üîÑ</span>
        <span>Actualizar Citas</span>
      </button>
    </div>

    <div class="connection-status">
      @if (isAuthenticated()) {
        <div class="status-badge connected">
          <span class="status-dot"></span>
          <span>Google Calendar Conectado</span>
        </div>
      } @else {
        <button class="btn-modern google" (click)="authenticate()" [disabled]="isConnecting()">
          @if (isConnecting()) {
            <span class="btn-icon spinning">‚ü≥</span>
            <span>Conectando...</span>
          } @else {
            <span class="btn-icon">üîó</span>
            <span>Conectar Google</span>
          }
        </button>
      }
    </div>
  </div>

  <!-- Calendar Section -->
  <div class="calendar-section">
    <div class="section-header">
      <h2>üìÖ Calendario de Citas</h2>
      <div class="calendar-controls">
        <button class="control-btn active">Mes</button>
        <button class="control-btn">Semana</button>
        <button class="control-btn">D√≠a</button>
      </div>
    </div>
    <div class="calendar-wrapper">
      <div id="calendar"></div>
    </div>
  </div>

  <!-- Modal para detalles de la cita -->
  @if (showEventModal()) {
    <div class="modal-overlay" (click)="closeEventModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>üìÖ Detalles de la Cita</h3>
          <button class="close-btn" (click)="closeEventModal()">‚úï</button>
        </div>
        <div class="modal-body">
          <div class="event-details">
            <div class="detail-item">
              <strong>Cita:</strong>
              <span>{{ selectedEvent()?.title }}</span>
            </div>
            <div class="detail-item">
              <strong>Fecha:</strong>
              <span>{{ formatDate(selectedEvent()?.start) }}</span>
            </div>
            <div class="detail-item">
              <strong>Hora:</strong>
              <span>{{ formatTime(selectedEvent()?.start) }} - {{ formatTime(selectedEvent()?.end) }}</span>
            </div>
            <div class="detail-item">
              <strong>Descripci√≥n:</strong>
              <span>{{ selectedEvent()?.extendedProps?.description || 'Sin descripci√≥n' }}</span>
            </div>
            <div class="detail-item">
              <strong>Ubicaci√≥n:</strong>
              <span>{{ selectedEvent()?.extendedProps?.location || 'No especificada' }}</span>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn danger" (click)="cancelAppointment()">‚ùå Cancelar Cita</button>
          <button class="btn" (click)="closeEventModal()">Cerrar</button>
        </div>
      </div>
    </div>
  }

  <!-- Modal para crear nueva cita -->
  @if (showModal()) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>‚ûï Nueva Cita M√©dica</h3>
          <button class="close-btn" (click)="closeModal()">‚úï</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Especialidad:</label>
            <select [(ngModel)]="especialidadSeleccionada" (change)="filtrarPorEspecialidad(especialidadSeleccionada)">
              <option value="">Todas las especialidades</option>
              @for (esp of especialidades(); track esp) {
                <option [value]="esp">{{ esp }}</option>
              }
            </select>
          </div>
          <div class="form-group">
            <label>Profesional: *</label>
            <select [(ngModel)]="newAppointment.profesional_id" (change)="onProfesionalChange(newAppointment.profesional_id)" required>
              <option value="">Selecciona un profesional</option>
              @for (prof of profesionalesFiltrados(); track prof.id) {
                <option [value]="prof.id.toString()">{{ prof.nombre }} {{ prof.apellido }}{{ prof.especialidad ? ' - ' + prof.especialidad : '' }}</option>
              }
            </select>
          </div>
          <div class="form-group">
            <label>Email del Profesional:</label>
            <input type="email" [(ngModel)]="newAppointment.mail" readonly placeholder="Se auto-completa al seleccionar profesional">
          </div>
          <div class="form-group">
            <label>Fecha: *</label>
            <input type="date" [(ngModel)]="newAppointment.fecha" required>
          </div>
          <div class="form-group">
            <label>Hora: *</label>
            <input type="time" [(ngModel)]="newAppointment.hora" required>
          </div>
          <div class="form-group">
            <label>Duraci√≥n:</label>
            <select [(ngModel)]="newAppointment.duracion">
              <option value="30">30 minutos</option>
              <option value="60">1 hora</option>
              <option value="90">1.5 horas</option>
            </select>
          </div>
          <div class="form-group">
            <label>Notas:</label>
            <textarea [(ngModel)]="newAppointment.notas" placeholder="Notas adicionales (s√≠ntomas, alergias, etc.)"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn" (click)="closeModal()">Cancelar</button>
          <button class="btn success" (click)="saveAppointment()">üíæ Guardar Cita</button>
        </div>
      </div>
    </div>
  }
</div>
